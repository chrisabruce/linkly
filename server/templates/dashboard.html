{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
    {% if let Some(msg) = flash_success %}
        <div class="flash success">{{ msg }}</div>
    {% endif %}
    {% if let Some(msg) = flash_error %}
        <div class="flash error">{{ msg }}</div>
    {% endif %}

    <article class="form-card">
        <header><strong>Shorten a new link</strong></header>
        <form method="POST" action="/admin/links">
            <div class="form-row">
                <label>
                    Destination URL
                    <input type="url" name="url" placeholder="https://example.com/some/long/path" required />
                </label>
                <label>
                    Title <small style="color:var(--pico-muted-color)">(optional)</small>
                    <input type="text" name="title" placeholder="My link" />
                </label>
                <label>
                    Custom code <small style="color:var(--pico-muted-color)">(optional)</small>
                    <input type="text" name="custom_code" placeholder="my-link"
                           pattern="[A-Za-z0-9\-]+" title="Letters, numbers, and hyphens only" />
                </label>
                <div>
                    <button type="submit">Shorten ↗</button>
                </div>
            </div>
            <div style="margin-top:0.6rem;">
                <label>
                    Description <small style="color:var(--pico-muted-color)">(optional — remind yourself why this link was created)</small>
                    <input type="text" name="description"
                           placeholder="e.g. Q3 newsletter campaign — sent to all subscribers" />
                </label>
            </div>
        </form>
    </article>

    <div class="table-scroll">
        {% if links.is_empty() %}
            <p style="color:var(--pico-muted-color); text-align:center; padding:3rem 0;">No links yet — create one above.</p>
        {% else %}
            <table>
                <thead>
                    <tr>
                        <th>Short link</th>
                        <th>Title / Destination</th>
                        <th style="text-align:right;">Clicks</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for link in links %}
                        <tr>
                            <td>
                                <a class="short-link" href="/{{ link.short_code }}" target="_blank" rel="noopener">{{ base_url }}/{{ link.short_code }}</a>
                            </td>
                            <td class="url-cell">
                                {% if let Some(t) = link.title %}
                                    <span title="{{ link.original_url }}">
                                        <strong>{{ t }}</strong><br />
                                        <small style="color:var(--pico-muted-color);">{{ link.original_url }}</small>
                                    </span>
                                {% else %}
                                    <span title="{{ link.original_url }}">{{ link.original_url }}</span>
                                {% endif %}
                                {% if let Some(desc) = link.description %}
                                    <br /><span style="font-size:0.78rem; color:var(--pico-muted-color); font-style:italic;">{{ desc }}</span>
                                {% endif %}
                            </td>
                            <td style="text-align:right; font-variant-numeric:tabular-nums; font-weight:600;">{{ link.click_count }}</td>
                            <td>
                                {% if link.is_active %}
                                    <span class="badge active">Active</span>
                                {% else %}
                                    <span class="badge inactive">Inactive</span>
                                {% endif %}
                            </td>
                            <td style="white-space:nowrap; color:var(--pico-muted-color); font-size:0.82rem;">{{ link.created_at.format("%Y-%m-%d") }}</td>
                            <td style="white-space:nowrap;">
                                <a href="/admin/links/{{ link.id }}/analytics"
                                   role="button"
                                   style="font-size:0.8rem; padding:0.3em 0.7em; margin-right:0.4rem;">Analytics</a>
                                <form method="POST"
                                      action="/admin/links/{{ link.id }}/delete"
                                      style="display:inline;"
                                      onsubmit="return confirm('Delete \'{{ link.short_code }}\'? This cannot be undone.');">
                                    <button type="submit" class="delete-btn">Delete</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
{% endblock %}
